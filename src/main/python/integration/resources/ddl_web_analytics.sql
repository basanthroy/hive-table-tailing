{
  "tracking_id": "0305A750-0DB1-4B1A-979D-9D860353A899",
  "application_name": null,
  "application_user_id": null,
  "application_version": "11.8.2.2",
  "application_build": "2",
  "conn_type": "WIFI",
  "timezone": "America/Los_Angeles",
  "user_language": "en",
  "sdk_version": "3.3.0",
  "source": "ADVERTISER_SDK",
  "page": {
    "page": {
      "referrer": "http://www.radiumone.com",
      "title": "AdTech Ninjas",
      "url": "www.cnn.com",
      "scroll_position": "30x40"
    }
  },
  "device_info": {
    "device_info": {
      "id_info": {
        "post_cookie": "32charactersneeded",
        "ob_login": "ob_login_value",
        "opt_out": false
      },
      "ip_v4": "92.117.48.48.99.48.92.117.48.48.97.56.92.117.48.48.48.49.92.117.48.48.52.54",
      "user_agent": "Mozilla/5.0 (iPad; CPU OS 10_1_1 like Mac OS X) AppleWebKit/602.2.14 (KHTML, like Gecko) Mobile/14B100",
      "screen": {
        "width": 320,
        "height": 568,
        "density": 2,
        "viewport_size": "768x1024"
      }
    }
  },
  "event_info": {
    "event_info": [
      {
        "event_name": "Key-SearchBegan",
        "key_value": {
          "network": "RealZeit - Android",
          "source": "RealiZeit > RealZeit - Android",
          "id": "123",
          "name": "Shoes",
          "currency": "USD",
          "receipt_status": "no_receipt"
        },
        "lat": null,
        "lon": null,
        "session_id": "D8A7BBF6-DCF2-40AA-9E66-B78C44B816E5",
        "timestamp": 1481329407375,
        "transaction_id": "92.117.48.48.52.102.92.117.48.48.48.51.92.117.48.48.99.51.92.117.48.48.52.56.92.117.48.48.100.55.92.117.48.48.48.56.92.117.48.48.52.54.92.117.48.48.98.57.92.117.48.48.56.50.92.117.48.48.100.54.92.117.48.48.98.54.92.117.48.48.55.50.92.117.48.48.48.97.92.117.48.48.102.97.92.117.48.48.52.57.92.117.48.48.102.102"
      }
    ]
  }
}


------------------------------------------------------------------------------------------
ADD JAR /usr/lib/hive-hcatalog/share/hcatalog/hive-hcatalog-core.jar;
set hive.exec.dynamic.partition.mode=nonstrict;

------------------------------------------------------------------------------------------------------------

('0305A750-0DB1-4B1A-979D-9D860353A899', '044216C9-BB2B-422D-9AA0-5EA581C7AFD9', '06341684-DE04-4F35-9B26-70DAB5A710D0', '0781049B-A29D-4472-BEAF-C711D2A7E9D8', '0BB5B864-69C2-4898-85D0-1B7FF5CAF573', '128C77DF-148D-4304-8AC9-77E99B84C7BB', '1705FFF1-4929-4A44-A095-DD079997E2BA', '1837E92A-E892-4D7F-B66B-A39A4E3185A2', '1A87CB1E-09A6-4652-9884-B89C91B64DFB', '1DDF1EA6-0612-4703-90FF-52D21733EDCF', '1EA86F24-B75B-4960-B148-115474F20256', '225AF7B0-8D45-4D1E-A34F-4FE36E22F393', '231F423D-20F1-4AE2-B03B-9A0F52A61CEB', '4BBBB699-042C-4C29-8DF4-3FBB22E26468', '4FA96827-215B-4CCD-8288-05ECFAF11218', '5527BF77-A06D-4839-B3C8-5CB943535C84', '55C00938-9D74-4BB1-AD2C-B78D7F359B5E', '5EBBE993-3B40-41DD-81DB-A73A590AE911', '6056B16E-4E77-4C6A-96BC-ED155024239C', '6250E965-17FE-4D01-863E-D290EE1CBC14', '62D2316B-D196-46AF-B5EF-F6A0D8D3BEAE', '6425ECC4-CB92-49FC-8E84-7C04FDF14C99', '66B14541-DE96-4F9D-9626-76A4AFD41537', '7017FA0F-4D3E-4F2B-BBCA-D1F312F18AF9', '70EBB44D-BDA8-4DC3-BF9B-B7536ED127DE', '76C6C9F4-80E3-4F47-A14F-66DF531CA99E', '76CEE796-EFFE-4C2C-B1B7-40F3FE095FE4', '79CB5EE2-C446-4DA1-A156-982D8371B3AE', '7BFD66D3-BAD4-4B2F-8D00-B9F2E25E3A69', '7FDA627E-88E6-4588-82FD-94F4916FCB28', '819C10F9-4471-43A7-9721-A70EA6AE1382', '85051A62-439E-45A3-BB73-7023D5C88A61', '888ACF7A-156C-4DD9-9E74-36D4FDA044FD', '9165DC52-9790-4465-8EF4-13C6F645B7AC', '92B3143E-DED1-4932-8D70-490CB7E9DA65', '93522674-F1E1-4FEC-9BA6-B61612F3442D', '97F2DF9E-7EC5-4356-81AA-1B048DBEF96C', '99C8DB8A-50A6-478E-9CFB-429A540DC0D2', '9D4BD020-D331-4334-80AF-1DE2F44D21E3', '9D5FC077-226A-4D13-8FC5-782801723D2C', '9D6659AD-3F0E-4E06-A4D7-4BF8DC0FAE80', '9F5EFB89-60FE-47E9-9882-5CF1C5DA2338', '9FF17375-6947-46A4-83C7-E12DA515380B', 'A48247BD-F427-444A-9449-9E84C0358F75', 'A77CF909-CE38-4A1C-8B12-D3D6ED3C8AE6', 'AB0115F7-F1B7-4DE4-8F74-133185076048', 'AC59E450-CE6D-4C36-B072-7C264A64E373', 'AE699F05-650C-485B-BCFD-4F89623EB8A1', 'B146AE99-98EE-431C-81F8-B888358E9589', 'B90E56A7-643D-4B6C-A5EB-203AC9B9CEAC', 'BF271D00-11A9-4E5E-9DA0-5465B9C79D40', 'BFFE3975-90C4-4F85-8484-BB12377F3BC0', 'C0F1F765-D695-4E8A-AC60-E922494C58F2', 'C1EDFB40-D7BA-4310-937F-9A36A997BC58', 'C3050382-86F1-4D8B-B80D-D09BFA2F397D', 'C3619617-85CF-40CE-A34F-8BF2370B91C3', 'C5F5A85A-B11E-43B4-B5FF-C42C32F4E7CE', 'C7E50842-ABC1-4E4E-BCB5-7C0A6A0B25B0', 'CA853720-913F-42CD-8F46-BA9FC7EDB746', 'CFF5C8EB-2082-40BE-91A1-D7BDD80EF595', 'D1972910-DCF5-41AE-A1F5-898C771679F4', 'D4CAD54F-2136-487B-8886-9B1846A47B35', 'D8E124C0-71F3-47D0-AD66-47A631DC3335', 'E8FD6CAC-281F-4300-9DA3-7293C6561A27', 'EDE4C40D-2CDB-47CE-8CBC-E95A94E3125F', 'F3DB8851-BB71-4FD4-955F-907835C40E9D', 'F53A010D-2F1B-48DC-87F3-65D768FCDBEC', 'F976A50C-8D3B-41EA-B724-2959BB8456B9', 'FC818D37-D3F8-43DC-97D7-A58C1E3B9CAD', '194CA301-33DE-4B0C-93EC-BD8C0231CD2C', 'AD63A057-B848-4831-966B-1B82B690AE49', 'CE67A047-629E-4228-ACFD-52070F1A5EB8', '2DB99713-DBE6-4932-BDC3-D66DF8DD6D38', '9D741287-1358-488D-BB56-2C57AF5BB8D5', '17CA5DAF-B7FE-42BA-BE25-AF78EA3657C9', '4F90F43D-0610-4385-A13F-4C04181FEC56', '6737D795-B60E-4804-97AC-B05E1D8D806A', '93915D3A-05C1-49DE-9AE5-754675DD43EE', '9FBFD7FA-01AF-4E9E-B3DF-F8D59CFF2E80', '39A2C2D6-1886-4D6C-9C59-6660FA956C2B', '74B7A016-351C-4479-BADD-115C8CD9A198', 'ADEC7F8E-5425-43A1-B659-E2B1340849D8', '57CA0A34-CAAB-4EF4-AA60-5DDD931ADA58', '1314127B-4BC4-4189-8C75-7B673F62752E', 'B491787F-21E1-4670-BE74-17FBF3C663D8', '1DA920C6-72F5-4B47-ACC5-0E81A06CA852', '21AF1FEA-D463-48F4-9213-E38C91407186', '4ED10645-5D2E-476D-9C90-A29B5C12E365', '921D7301-537A-4A97-AC31-C80D89A49799', 'C11DC874-7582-4F82-9DAD-94244FAFC999', '3878D6B9-BF63-41B5-8B08-40C73E40A761', '51917CA9-C205-4734-912C-1B40E02DAA86', '8EB25B6C-F9BD-4D20-8C4C-CC27198E6420', '8965E1CD-383B-4A7B-A274-2F054D880D89', 'AAB3D4E4-CBA7-49A4-8223-9C81B9041392', '5E78DE11-1034-4B01-9773-04D4E2DCF09D', '2A112DA0-9B27-4C10-B3A2-99E5268ECCB5', 'EF8FD8BA-ECE9-45ED-A37C-38B424EC8B10', '1E90B978-9CC8-480E-87B5-8BC0B6C9C656', '44D5AD5A-DD1A-4D69-9A7D-8AECAD991BD2', '4245CACD-01D7-44D9-8340-4DF10A60D21B', 'B80854A8-7B56-4041-8DED-F353890C7976', '01DBDD70-27A5-4455-8086-46585C13C660', '148E2018-68C9-4C45-BDAD-EB765EAECE12', '2147B14F-6274-4D27-B21C-B58C65379512', '6EC6333A-E817-4CCA-8AB1-77D953116015', '65A0E5D0-8DF6-478B-BA9C-608E040F8380', '586A3C9F-6DF9-4F0A-9924-B5BBE9245455', 'EC10518F-9E2C-4FD3-BC1E-EE073F108F8F', '0960D618-5F36-4343-8D25-49E681FC4AA4', '822BEF6C-029E-4940-A876-DCB5DF13CF30', 'C813F76D-F79F-4F1C-BEE8-CA5CF3A7B71E', '02601A2D-9744-4D3F-855D-6E454A49FF82', '68CCD75B-1ACD-4202-97C2-600C1C497BA8', '3059AD67-EF79-41F6-B9C0-A68367CD132B', 'ECCC8AF7-0DD7-41B9-BF3C-86A1EA944FC0', '8AE62709-884C-4BCE-B836-C080FAD98207', 'D31E7C27-9D1C-4659-B03C-B3B7F3671D74', 'EFA647F8-8FE1-46D8-A4AC-4097DE6742A4')

------------------------------------------------------------------------------------------------------------

CREATE TABLE `web_analytics2`(
  `tracking_id` string COMMENT 'from deserializer',
  `application_name` string COMMENT 'from deserializer',
  `application_user_id` string COMMENT 'from deserializer',
  `application_version` string COMMENT 'from deserializer',
  `application_build` string COMMENT 'from deserializer',
  `conn_type` string COMMENT 'from deserializer',
  `timezone` string COMMENT 'from deserializer',
  `user_language` string COMMENT 'from deserializer',
  `sdk_version` string COMMENT 'from deserializer',
  `source` string COMMENT 'from deserializer',
  `page` struct<page:struct<referrer:string,title:string,url:string,scroll_position:string>> COMMENT 'from deserializer',
  `device_info` struct<device_info:struct<id_info:struct<post_cookie:string,ob_login:string,opt_out:boolean>,ip_v4:string,user_agent:string,screen:struct<width:bigint,height:bigint,density:bigint,viewport_size:string>>> COMMENT 'from deserializer',
  `event_info` struct<event_info:array<struct<event_name:string,key_value:struct<network:string,source:string,id:string,name:string,currency:string,receipt_status:string>,lat:bigint,lon:bigint,session_id:string,timestamp:bigint,transaction_id:string>>> COMMENT 'from deserializer')
PARTITIONED BY (
  `dt` int,
  `hr` int)
ROW FORMAT SERDE
  'org.apache.hive.hcatalog.data.JsonSerDe'


insert overwrite table web_analytics2 PARTITION(dt, hr)
select
  tracking_id,
  message.application_name,
  message.application_user_id,
  message.application_version,
  message.version as application_build,
  message.conn_type,
  'America/Los_Angeles' as timezone,
  message.user_language,
  message.sdk_version,
  message.source,
  named_struct("page", named_struct("referrer", "http://www.radiumone.com",
                                    "title", "AdTech Ninjas",
                                    "url", "www.cnn.com",
                                    "scroll_position", "30x40")) as page,
  named_struct("device_info", named_struct("id_info", named_struct("post_cookie", "32charactersneeded", "ob_login", "ob_login_value", "opt_out", false),
                                         "ip_v4", message.device_info.ip_v4,
                                         "user_agent", message.user_agent,
                                         "screen", named_struct("width", cast(320 as bigint), "height", cast(568 as bigint), "density",cast(2 as bigint), "viewport_size", message.viewport_size)
                                        )
  ) as device_info,
  named_struct("event_info", array(named_struct("event_name",message.event.event_name,
                                                "key_value", named_struct("network", "RealZeit - Android",
                                                                          "source", "RealiZeit > RealZeit - Android",
                                                                          "id", "123",
                                                                          "name", "Shoes",
                                                                          "currency", "USD",
                                                                          "receipt_status", "no_receipt"),
                                                "lat", message.event.lat,
                                                "lon", message.event.lon,
                                                "session_id", message.event.session_id,
                                                "timestamp", message.event.timestamp,
                                                "transaction_id", message.event.transaction_id))) as event_info
, dt, hr
from radiumone.tracker_event_server_ts_json
where dt in (20161210, 20161211, 20161212)
      and tracking_id in ('0305A750-0DB1-4B1A-979D-9D860353A899', '044216C9-BB2B-422D-9AA0-5EA581C7AFD9', '06341684-DE04-4F35-9B26-70DAB5A710D0', '0781049B-A29D-4472-BEAF-C711D2A7E9D8', '0BB5B864-69C2-4898-85D0-1B7FF5CAF573', '128C77DF-148D-4304-8AC9-77E99B84C7BB', '1705FFF1-4929-4A44-A095-DD079997E2BA', '1837E92A-E892-4D7F-B66B-A39A4E3185A2', '1A87CB1E-09A6-4652-9884-B89C91B64DFB', '1DDF1EA6-0612-4703-90FF-52D21733EDCF');


